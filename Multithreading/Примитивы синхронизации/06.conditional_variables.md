Используется в классическом виде для решения проблемы **Producer/Consumer**.

`cond_notify_one(&sync_lock)`

Пример с барьером, юзается для тестов, чтобы одновременно запустить дохуя тестов.

![[Pasted image 20240615001128.png]]
Cond variables - Это wait, notify.
Умеет уведомлять другие потоки. 

`pthread_cond_wait(&sync_cond, &sync_lock)`
1. Сначала атомарно **m.unlock(&sync_lock)**, который был передан, что логично, тк поток спит и ничё и так не будет делать.
2.  Уводит поток в спячку.

1.  Если кто-то будит поток на этой хуйне, то он встанет только тогда, когда mutex будет **unlock()**.
2. после пробуждения **m.lock()** делает.

###### Внутренности
`pthread_cond_wait(&sync_cond, &sync_lock)`{
```
m.unlock(&sync_lock)

//sleeep в kernel space
//get an broadcast

m.lock(&sync_lock) // есть оптимизация, чтобы не просыпаться и засыпать сразу
```

}

###### Спонтанное пробуждение
Нужно хуярить цикл, тк может произойти ложное пробуждение.

###### Java example

#Java 

![[Pasted image 20240615003917.png]]